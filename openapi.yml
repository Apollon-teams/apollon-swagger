openapi: 3.0.3
info:
  title: Apollon API
  description: |
    Apollon 顧客管理サービスのAPI仕様書です。
    このドキュメントは、Web予約システムに必要なエンドポイントを定義します。
  version: 2.0.0
  contact:
    name: API Support
    email: support@example.com
servers:
  - url: http://localhost:8080/v1
    description: 開発環境サーバー
  - url: https://api.apollon.example.com/v1
    description: 本番環境サーバー

tags:
  - name: Web
    description: Web予約関連

paths:
  /web/shops/{shopId}/attendance-casts:
    get:
      tags:
        - Web
      summary: アテンダンスキャスト一覧取得API
      description: 指定された店舗と日付における出勤キャストの一覧を取得します。
      parameters:
        - $ref: "./components/parameters/web/ShopId.yaml"
        - $ref: "./components/parameters/web/Date.yaml"
      responses:
        "200":
          description: 成功
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/AttendanceCast"
        "404":
          description: 店舗が見つかりません
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /web/shops/{shopId}:
    get:
      tags:
        - Web
      summary: 店舗情報取得API
      description: 指定したIDの店舗情報を取得します。
      parameters:
        - $ref: "./components/parameters/web/ShopId.yaml"
      responses:
        "200":
          description: 成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ShopInfo"
        "404":
          description: 店舗が見つかりません
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /web/shops/{shopId}/prices:
    get:
      tags:
        - Web
      summary: 料金情報取得API
      description: 指定した店舗の料金情報を取得します。
      parameters:
        - $ref: "./components/parameters/web/ShopId.yaml"
      responses:
        "200":
          description: 成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PriceInfo"
        "404":
          description: 店舗が見つかりません
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /web/casts/{castId}:
    get:
      tags:
        - Web
      summary: キャスト情報詳細取得API
      description: 指定したIDのキャストの詳細情報を取得します。
      parameters:
        - $ref: "./components/parameters/web/CastId.yaml"
        - name: shopId
          in: query
          required: false
          description: 店舗ID (キャストが複数の店舗に所属する場合の絞り込みに利用)
          schema:
            type: string
            example: "1014"
      responses:
        "200":
          description: 成功
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CastDetail"
        "404":
          description: キャストが見つかりません
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /web/reservations:
    post:
      tags:
        - Web
      summary: Web予約フォーム送信API
      description: 顧客がWeb予約フォームから予約情報を送信します。
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Reservation"
      responses:
        "201":
          description: 予約成功
        "400":
          description: リクエストが不正です
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: 指定されたキャスト、またはコースが見つかりません
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "409":
          description: 予約時間が既に埋まっています
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: サーバー内部エラー
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

components:
  schemas:
    AttendanceCast:
      $ref: "./components/results/web/AttendanceCast.yaml"
    CastDetail:
      $ref: "./components/results/web/CastDetail.yaml"
    Error:
      $ref: "./components/models/common/Error.yaml"
    PriceInfo:
      $ref: "./components/results/web/PriceInfo.yaml"
    Reservation:
      $ref: "./components/models/web/Reservation.yaml"
    ShopInfo:
      $ref: "./components/results/web/ShopInfo.yaml"
  securitySchemes:
    BearerAuth:
      $ref: "./components/securitySchemes/BearerAuth.yaml"
